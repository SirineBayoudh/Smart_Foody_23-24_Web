{% extends 'base_back.html.twig' %}
{% block body %}
	<div class="main-panel">
		<div class="content-wrapper" style="width: 2200px;">
			<div class="row" style="width: 500px;margin-left:20px;">
				<div class="col-md-6 grid-margin stretch-card">
					<div class="card card-tale" style="background-color: #56AB2F;">
						<div class="card-body text text-center">
							<h4 class="mb-4">Moyenne des notes</h4>
							<p class="fs-30 mb-2">{{ averageRating }}</p>
						</div>
					</div>
					<div class="card card-tale" style="background-color: #56AB2F;margin-left:10px;">
						<div class="card-body text text-center">
							<h4 class="mb-4">Total des conseils</h4>
							<p class="fs-30 mb-2">{{ totalConseils }}</p>
						</div>
					</div>
					<div class="card card-tale" style="background-color: #56AB2F;margin-left:10px;">
						<div class="card-body text text-center">
							<h4 class="mb-4">Conseils en attente</h4>
							<p class="fs-30 mb-2">{{ conseilsEnAttente }}</p>
						</div>
					</div>
					<div class="card card-tale" style="background-color: #56AB2F;margin-left:10px;">
						<div class="card-body text text-center">
							<h4 class="mb-4">Conseils terminés</h4>
							<p class="fs-30 mb-2">{{ conseilsTermines }}</p>
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="width:800px;margin-top:-20px;text-align:center;margin-left:100px;">
				<div class="col-lg-6 grid-margin grid-margin-lg-0 stretch-card">
					<div class="card">
						<div class="card-body">
							<h4 class="card-title">Conseils Par Statut</h4>
							<canvas id="pieChart" width="300" height="200"></canvas>
						</div>
					</div>
				</div>
				<div class="col-lg-6 grid-margin grid-margin-lg-0 stretch-card">
					<div class="card">
						<div class="card-body">
							<h4 class="card-title">Distribution Des Notes</h4>
							<canvas id="barChart" width="300" height="200"></canvas>
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="margin-top:20px;text-align:center;">
				<div class="col-lg-6 grid-margin stretch-card">
					<div class="card">
						<div class="card-body">
							<form method="GET" action="{{ path('conseil_listDB') }}" class="mb-4">
								<div class="input-group" style="width:600px;">
									<label class="input-group-append" for="statut" style="font-size:15px;color:black;margin-right:10px;">Filtrer par statut :</label>
									<select name="statut" id="statut" class="form-control">
										<option value="Tous">Tous</option>
										<option value="en attente">En attente</option>
										<option value="terminé">Terminé</option>
									</select>
									<label class="input-group-append" for="note" style="font-size:15px; margin-left:10px;color:black;margin-right:10px;">Filtrer par note :</label>
									<select name="note" id="note" class="form-control">
										<option value="">Toutes</option>
										<option value="1">1</option>
										<option value="2">2</option>
										<option value="3">3</option>
										<option value="4">4</option>
										<option value="5">5</option>
									</select>
									<div class="input-group-append" style="margin-left:10px;">
										<button type="submit" class="btn btn-success">Filtrer</button>
									</div>
								</div>
							</form>
							<h4 class="card-title">Liste des demandes</h4>
							<div class="table-responsive">
								<table class="table table-hover">
									<thead>
										<tr class="text-center">
											<th>Client</th>
											<th>Statut</th>
											<th>Demande</th>
											<th>Réponse</th>
											<th>Note</th>
											<th>Date</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for a in conseils %}
											<tr class="text-center">
												<td>{{ a.getIdClient().getPrenom() ~ ' ' ~ a.getIdClient().getNom() }}</td>
												{% if a.statut == 'terminé' %}
													<td>
														<label class="badge badge-success">{{ a.statut }}</label>
													</td>
												{% elseif a.statut == 'en attente' %}
													<td>
														<label class="badge badge-warning">{{ a.statut }}</label>
													</td>
												{% else %}
													<td>{{ a.statut }}</td>
												{% endif %}
												<td>{{ a.demande }}</td>
												<td>{{ a.reponse }}</td>
												{% if a.note <= 2 %}
													<td class="text-danger">{{ a.note }}</td>
												{% else %}
													<td class="text-success">{{ a.note }}</td>
												{% endif %}
												<td>{{ a.dateConseil|date("d/m/Y") }}</td>
												<td>
													<a href="{{ path('conseil_delete', {'id': a.idConseil}) }}" class="btn btn-danger btn-rounded btn-fw delete-button" data-id="{{ a.idConseil }}">Supprimer</a>
													<button type="button" class="btn btn-danger btn-rounded btn-fw">
														<a href="{{ path('conseil_rep_update', {'id': a.idConseil}) }}" style="color: white;">Modifier</a>
													</button>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
							<div class="d-flex justify-content-center">
								{{ knp_pagination_render(conseils) }}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		var ctx = document.getElementById('pieChart').getContext('2d');
var pieChart = new Chart(ctx, {
type: 'pie',
data: {
labels: [
'En attente', 'Terminé'
],
datasets: [
{
label: 'Conseils',
data: [
{{ conseilsEnAttente }}, {{ conseilsTermines }}
],
backgroundColor: ['#56AB2F', '#cce5c0',]
}
]
},
options: {
responsive: false,
maintainAspectRatio: false
}
});
	</script>
	<script>
		var ctx = document.getElementById('barChart').getContext('2d');
var barChart = new Chart(ctx, {
type: 'bar',
data: {
labels: [
'1',
'2',
'3',
'4',
'5'
], // Notes
datasets: [
{
label: 'Nombre de conseils',
data: [
{{ notesCount[1] ?? 0 }},
{{ notesCount[2] ?? 0 }},
{{ notesCount[3] ?? 0 }},
{{ notesCount[4] ?? 0 }},
{{ notesCount[5] ?? 0 }}
],
backgroundColor: 'rgba(54, 162, 235, 0.5)', // Blue color for bars
borderColor: 'rgba(54, 162, 235, 1)',
borderWidth: 1
}
]
},
options: {
responsive: false,
maintainAspectRatio: false,
scales: {
yAxes: [
{
ticks: {
beginAtZero: true
}
}
]
}
}
});
	</script>
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
	<style>
		.ajs-message.ajs-success {
			color: white !important;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
alertify.set('notifier', 'position', 'top-right');
$('.delete-button').click(function (e) {
e.preventDefault();
var href = $(this).attr('href');
alertify.confirm('Confirmation', 'Êtes-vous sûr de bien vouloir supprimer cette demande?', function () {
alertify.success('Demande supprimée.');
setTimeout(function () {
window.location.href = href;
}, 600);
}, function () {
alertify.error('Suppression annulée.');
});
});
});
	</script>
{% endblock %}

{% extends 'base_back.html.twig' %}

{% block title %}AvisBack{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block body %}
<style>
  .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
 .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }

 /* CSS pour l'effet hover sur les lignes de tableau */
 .table-striped tbody tr:hover {
     background-color: #bbddab; /* Couleur de fond au survol */
     color: #fff; /* Couleur du texte au survol */
 }

 /* Styles pour les boutons */
 .btn {
     /* Styles normaux des boutons */
     background-color: #56ab2f;
     border-color: #56ab2f;
     color: #ffffff; /* Couleur du texte */
     transition: background-color 0.3s; /* Transition fluide pour la couleur de fond */
 }

 /* Styles pour les boutons lorsqu'ils sont survolés */
 .btn:hover {
     background-color: #72c22f; /* Nouvelle couleur de fond */
 }
 .btn.dropdown-toggle:focus {
 background-color: #ffffff; /* Couleur de fond du bouton lorsqu'il est ouvert */
 color: #000000; /* Couleur du texte du bouton lorsqu'il est ouvert */
}
.thead-green {
     background-color: #77bb58;
     color: white;
     position: sticky;
     top: 0;
     z-index: 1;
 }
 .text-green {
 color: green !important;
}
.bg-custom-green {
     background-color: #56ab2f !important; /* votre nouvelle couleur verte */
     color: white;
 }
</style>
<div>
    <br>
    <div class="table-responsive" id="reclamationsTable">
        <h1 class="card-title">Liste des Avis</h1>
        <table class="table table-striped" id="avisTable">
            <thead class="bg-custom-green">
                <tr class="text-center">
                    <th>Id Avis</th>
                    <th>Ref Produit</th>
                    <th>Id Client</th>
                    <th>Note</th>
                    <th>Commentaire</th>
                    <th>Signale</th>
                    <th>Date Avis</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for avis in Avis %}
                <tr class="text-center avisRow" title="{{avis.getRefProduit().marque}}">
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.getId }}</td>
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.getRefProduit().getRef() }}</td>
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.getIdClient().getId() }}</td>
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.getNbEtoiles }}</td>
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.commentaire }}</td>
                    <td data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.signaler }}</td>
                    <td  data-avis-id="{{ avis.id }}" onclick="window.location='{{ path('calculPersonne', {'ref_produit': avis.getRefProduit().getRef()}) }}'">{{ avis.getDateAvis|date('d-m-Y') }}</td>
                    <td>
                      <button class="btn btn-success btn-sm" onclick="confirmRepondre('{{ path('refreshSignal', {'id_avis': avis.id}) }}')" title="Refresh signal">
                          <i class="ti-reload"></i>
                      </button>
                      
                      <button class="btn btn-danger btn-sm" onclick="confirmSupprimer('{{ path('deleteAvis', {'id_avis': avis.id}) }}')" title="Supprimer">
                          <i class="ti-trash"></i>
                      </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


<br>

<div class="row">
  <div class="col-md-12 col-xl-3">
      <div class="d-flex flex-column justify-content-start">
          <div class="ml-xl-4 mt-3">
              <p class="card-title">Details sur les avis</p>
              <h1 class="text-success">{{ totalAvis }}</h1>
              <h3 class="font-weight-500 mb-xl-4 text-success">Moyenne de chaque note</h3>
              <p class="mb-2 mb-xl-0">Les statiques de tous les produits en fonction des notes des clients</p>
          </div>
      </div>
  </div>
  <div class="col-md-12 col-xl-9">
      <div class="row">
          <div class="col-md-6 border-right">
              <div class="table-responsive mb-3 mb-md-0 mt-3">
                  <table class="table table-borderless report-table">
                      {% for note, count in counts %}                                 
                      <tr>
                          <td class="text-muted">Note : {{ note }}</td>
                          <td class="w-100 px-0">
                              <div class="progress progress-md mx-4">
                                  <div class="progress-bar bg-success" role="progressbar" style="width: {{ (count / totalAvis) * 100 }}%" aria-valuenow="{{ (count / totalAvis) * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                              </div>
                          </td>
                          <td><h5 class="font-weight-bold mb-0">{{ count }}</h5></td>
                      </tr>
                      {% endfor %}
                  </table>
              </div>
          </div>
          <div class="col-md-6">
              <canvas id="myChart" style="width:100%;max-width:600px" data-x-values="1,2,3,4,5" data-y-values="{{ yValues }}"></canvas>
          </div>
      </div>
  </div>
</div>

</div>

     <!-- Boite de dialogue -->
     <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
     <script>
         function confirmRepondre(url) {
             Swal.fire({
                 title: 'Êtes-vous sûr?',
                 text: "Ce commentaire respecte les normes?",
                 icon: 'warning',
                 showCancelButton: true,
                 confirmButtonColor: '#dc3545',
                 cancelButtonColor: '#28a745',
                 confirmButtonText: 'Oui, refresh!'
             }).then((result) => {
                 if (result.isConfirmed) {
                     window.location.href = url;
                 }
             });
         }
     
         function confirmSupprimer(url) {
             Swal.fire({
                 title: 'Êtes-vous sûr?',
                 text: "Voulez-vous supprimer cet avis?",
                 icon: 'warning',
                 showCancelButton: true,
                 confirmButtonColor: '#dc3545',
                 cancelButtonColor: '#28a745',
                 confirmButtonText: 'Oui, supprimer!'
             }).then((result) => {
                 if (result.isConfirmed) {
                     window.location.href = url;
                 }
             });
         }
     
     </script>

<!-- GEstion du graphes -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script>
        const canvas = document.getElementById('myChart');
        const xValues = canvas.getAttribute('data-x-values').split(',');
        const yValues = canvas.getAttribute('data-y-values').split(',').map(Number);
        const barColors = [
          "#b91d47",
          "#00aba9",
          "#2b5797",
          "#e8c3b9",
          "#1e7145"
        ];
        
        new Chart("myChart", {
          type: "pie",
          data: {
            labels: xValues,
            datasets: [{
              backgroundColor: barColors,
              data: yValues
            }]
          },
          options: {
            title: {
              display: true,
              text: "Nombre de personne ayant donné la note pour ce produit"
            }
          }
        });
    </script>


{% endblock %}
